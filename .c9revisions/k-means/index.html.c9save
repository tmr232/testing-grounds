{"ts":1350762262974,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"<!--\r\nTo change this template, choose Tools | Templates\r\nand open the template in the editor.\r\n-->\r\n<!DOCTYPE html>\r\n<html>\r\n    <head>\r\n        <title></title>\r\n        <script src=\"js/libs/jquery-1.8.0/jquery.min.js\"></script>\r\n        <script src=\"js/libs/sylvester-0-1-3/sylvester.js\"></script>\r\n        <script src=\"js/script.js\"></script>\r\n        <script>\r\n            //TODO: Learn how to properly preload images!!!\r\n            \r\n            function getPixel(imageData, index)\r\n            {\r\n                var pixel = $V([\r\n                        imageData.data[index+0],    //r\r\n                        imageData.data[index+1],    //g\r\n                        imageData.data[index+2],    //b\r\n                        imageData.data[index+3]     //a\r\n                ]);\r\n                return pixel;\r\n            }\r\n            \r\n            function setPixel(imageData, index, pixel)\r\n            {\r\n                pixel = pixel.elements;\r\n                imageData.data[index+0] = Math.floor(pixel[0]);    //r\r\n                imageData.data[index+1] = Math.floor(pixel[1]);    //g\r\n                imageData.data[index+2] = Math.floor(pixel[2]);    //b\r\n                imageData.data[index+3] = Math.floor(pixel[3]);    //a\r\n            }\r\n            \r\n            function pixelMean(pixels, indices)\r\n            {\r\n                var sum = $V([0,0,0,0]);\r\n                if (arguments.length === 1)\r\n                {\r\n                    $(pixels).each(function() {sum = sum.add(this);});\r\n                    \r\n                }\r\n                else\r\n                {\r\n                    $(indices).each(function() {sum = sum.add(pixels[this]);});\r\n                }\r\n                sum = sum.x(1/pixels.length);\r\n                sum.elements[3] = 255;\r\n                return sum;\r\n            }\r\n            \r\n            function updateMeans(pixels, sets, means)\r\n            {\r\n                var new_means = new Array(means.length);\r\n                for (var i = 0; i < means.length; ++i)\r\n                {\r\n                    new_means[i] = pixelMean(pixels, sets[i]);\r\n                }\r\n                return new_means;\r\n            }\r\n            \r\n            function randInt(min, max)\r\n            {\r\n                var range = max - min;\r\n                var value = Math.floor(Math.random() * range);\r\n                value += min;\r\n                return value;\r\n            }\r\n            \r\n            function randPixel()\r\n            {\r\n                return $V([randInt(0,255),randInt(0,255),randInt(0,255), 255]);\r\n            }\r\n            \r\n            function assignSets(pixels, means)\r\n            {\r\n                var sets = [];\r\n                $(means).each(function(){sets.push(new Array());});\r\n                $(pixels).each(\r\n                        function(index) {\r\n                            var dist = means[0].distanceFrom(this);\r\n                            var set = sets[0];\r\n                            for(var i = 0; i < means.length; ++i) {\r\n                                var new_dist = this.distanceFrom(means[i]);\r\n                                if (dist > new_dist) {\r\n                                    dist = new_dist;\r\n                                    set = sets[i];\r\n                                }\r\n                            }\r\n                            set.push(index);\r\n                        }\r\n                );\r\n                return sets;\r\n            }\r\n    \r\n            var image = new Image();\r\n            $(document).ready(init_images);\r\n            \r\n            function init_images()\r\n            {\r\n//                image.src = \"./images/dog.jpg\";\r\n                image.src = \"./images/gallery.jpg\";\r\n                $(image).load(init);\r\n            }\r\n    \r\n            function init()\r\n            {\r\n                //console.log(image.width);\r\n                var canvas = document.querySelector(\"#canvas\");\r\n                var context = canvas.getContext(\"2d\");\r\n                //console.log(image.width);\r\n                context.drawImage(image, 0, 0);\r\n                var imageData = context.getImageData(0,0,image.width, image.height);\r\n                \r\n                var means = [randPixel(), randPixel(), randPixel(), randPixel()];//, randPixel(), randPixel(), randPixel(), randPixel()];\r\n                var pixels = Array(image.width * image.height);\r\n        \r\n                for (var x = 0; x < image.width; ++x) \r\n                {\r\n                    for (var y = 0; y < image.height; ++y)\r\n                    {\r\n                        var index = (x+y*image.width) * 4;\r\n                        pixels[index / 4] = getPixel(imageData, index);\r\n//                        pixels.push(getPixel(imageData, index));\r\n//                        var amp = getPixel(imageData, index).distanceFrom($V([0,0,0,0]));\r\n//                        if (amp > 400) {\r\n//                            var p = getPixel(imageData, index);\r\n//                            p.setElements([p.e(1)*1.5,p.e(2)/3,0,p.e(4)]);\r\n//                            setPixel(imageData, index, p);\r\n//                        }\r\n                    }\r\n                }\r\n                var sets = assignSets(pixels, means);\r\n                console.log(means);\r\n                console.log(sets);\r\n                \r\n                for (var i = 0; i < means.length; ++i)\r\n                {\r\n                    $(sets[i]).each(function() {setPixel(imageData, this*4, means[i]);});\r\n                }\r\n                \r\n                context.putImageData(imageData,0,0);\r\n                \r\n                alert();\r\n                for (var n = 5; n >= 0; --n)\r\n                {\r\n                    means = updateMeans(pixels, sets, means);\r\n                    sets = assignSets(pixels, means);\r\n                }\r\n                \r\n                for (var i = 0; i < means.length; ++i)\r\n                {\r\n                    $(sets[i]).each(function() {setPixel(imageData, this*4, means[i]);});\r\n                }\r\n                \r\n                context.putImageData(imageData,0,0);\r\n            }\r\n        </script>\r\n        <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\r\n    </head>\r\n    <body>\r\n        <!--<img src=\"images/dog.jpg\"/>-->\r\n        <div>TODO write content</div>\r\n        <canvas id=\"canvas\" width=\"800\" height=\"600\">\r\n            \r\n        </canvas>\r\n    </body>\r\n</html>\r\n"]],"start1":0,"start2":0,"length1":0,"length2":6438}]],"length":6438}
